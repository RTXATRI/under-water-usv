<!--
     This launch file provides an example of how to work with GPS data using robot_localization. It runs three nodes:
       (1) An EKF instance that fuses odometry and IMU data and outputs an odom-frame state estimate
       (2) A second EKF instance that fuses the same data, but also fuses the transformed GPS data from (3)
       (3) An instance of navsat_transform_node, which takes in GPS data and produces pose data that has been
           transformed into your robot's world frame (here, map). The node produces a map-frame state estimate.

       The first EKF instance produces the odom->base_link transform. The second EKF produces the map->odom transform,
       but requires the odom->base_link transform from the first instance in order to do so. See the
       params/dual_ekf_navsat_example.yaml file for parameter specification.
-->

<launch>

  <rosparam command="load" file="$(find robot_localization)/params/dual_ekf_navsat.yaml" />

  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_se_odom" clear_params="true" output="screen"/>

  <node pkg="robot_localization" type="navsat_transform_node" name="navsat_transform" clear_params="true" >
    <remap from="odometry/filtered" to="odometry/filtered_map"/>
	  <remap from="imu/data" to="/sensor/m_imu"/>
      <remap from="gps/fix" to="/sensor/m_fix"/>
  </node>
  
    <node name="imu" pkg="uri_usv" type="imu" />
	 
  <arg name="port" default="/dev/ttyACM0" />
  <arg name="baud" default="9600" />
  <arg name="frame_id" default="gps" />
  <arg name="use_GNSS_time" default="False" />
  <arg name="time_ref_source" default="gps" />
  <arg name="useRMC" default="False" />

  <node name="nmea_serial_driver" pkg="nmea_navsat_driver" type="nmea_serial_driver" output="screen">
    <param name="port" value="$(arg port)"/>
    <param name="baud" value="$(arg baud)" />
    <param name="frame_id" value="$(arg frame_id)" />
    <param name="use_GNSS_time" value="$(arg use_GNSS_time)" />
    <param name="time_ref_source" value="$(arg time_ref_source)" />
	<remap from="/fix" to="/sensor/m_fix" />
    <param name="useRMC" value="$(arg useRMC)" />
  </node>	 
  <node pkg="tf" type="static_transform_publisher" name="tfgps" args="0 0 0 0 0 0 base_link gps 100" />
  <node pkg="tf" type="static_transform_publisher" name="tfimu" args="0 0 0 0 0 0 base_link imu 100" />
  
</launch>

